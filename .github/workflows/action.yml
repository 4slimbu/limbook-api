  name: limbook-api-ci

  on:
    push:
      branches:
        - develop
        - master
    pull_request:
      branches:
        - develop
        - master

  jobs:
    build-and-test:
      runs-on: ubuntu-latest
      strategy:
        matrix:
          python-version: ['3.x']

      name: Python ${{ matrix.python-version }}
      steps:
        - uses: actions/checkout@v2

        - name: Setup Python
          uses: actions/setup-python@v2
          with:
            python-version: ${{ matrix.python-version }}
            architecture: x64

        - name: Install dependencies
          run: |
            pip install -r requirements.txt

        - name: Run tests
          run: |
            python -m unittest tests/*test.py

#   Various rejection issues by heroku and feel like hack
#   Instead using heroku auto deployment feature is better and smooth
#   Also they have review app feature that creates review app for every
#   new pull request.
#
#        - name: Set heroku credentials
#          env:
#            HEROKU_LOGIN: ${{ secrets.HEROKU_LOGIN }}
#            HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
#          run: |
#            cat > ~/.netrc << EOF
#            machine api.heroku.com
#              login $HEROKU_LOGIN
#              password $HEROKU_API_KEY
#            machine git.heroku.com
#              login $HEROKU_LOGIN
#              password $HEROKU_API_KEY
#            EOF
#
#        - name: Deploy to staging
#          if: github.ref == 'refs/heads/develop'
#          run: |
#            heroku git:remote -a staging-limbook-api
#            git filter-branch -- --all
#            git push heroku HEAD:master
#
#        - name: Deploy to production
#          if: github.ref == 'refs/heads/master'
#          run: |
#            heroku git:remote -a limbook-api
#            git filter-branch -- --all
#            git push heroku HEAD:master

